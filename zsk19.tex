%% LyX 2.3.1 created this file.  For more info, see http://www.lyx.org/.
%% Do not edit unless you really know what you are doing.
\documentclass[english]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{babel}
\usepackage{pgf}
\begin{document}
\global\long\def\E{\mathbb{E}}%
\global\long\def\R{\mathbb{R}}%
\global\long\def\F{\mathcal{F}}%
\global\long\def\charf{\mathbf{1}}%
\global\long\def\barxi{\overline{\xi}}%
\global\long\def\X{\mathcal{X}}%


\section*{Description of the problem}

A steel company decides on ways of covering their emissions $Y_{1},\dots,Y_{T}$ stemming from their exogenously given production, at times $1,\dots,T$,
by a single type of allowances. At each $t=1,\dots,T$, $r_{t}$ allowances
is given (grandfathered) to the company for free. Further, allowances
may be bought (sold) at a secondary market at any time $t=0,\dots,T$.
The allowances may be saved (banked) for future periods. 

In addition to the spots, at each $t=0,\dots,T-1,$ futures with maturities
$t+1,t+2.\dots.T,$ may be bought. Moreover, at each $t=0,\dots,T-1$, call options with maturities $t+1,t+2.\dots.T,$
and strike prices $K_{1},\dots,K_{\kappa}$ may be bought at $t$.
In principle, the options
need not be exercised at the time of their maturity; however, as we neglect transaction costs, exercising only some options is
always no worse than exercising all options and possibly selling the
difference, so we may assume all the options are exercised. The company may trade with the allowances and their derivatives freely; however, they may no take short positions.

%The company may fund their emission trading by loans with an interest
%rate $\varrho$. The insufficiency of cash at $T$ is penalized by
%a prohibitive interest rate $\iota$.

The company is risk-averse minimizing the discounted nested mean-CVaR
risk measure, applied to the differences of profits from the production and the costs of emission trading. 

\subsection*{Problem definition}


The subject of decision is the way of optimal emission trading. In particular, at $t$, it is the number $\Delta s_{t}$ of
the spot allowances purchased/sold at $t$, the numbers $$\Delta f_{t}=(\Delta f_{t}^{t+1},\dots,\Delta f_{t}^{T})$$
of the futures with maturities $t+1,\dots,T$ purchased/sold, and the numbers 
\[
\Delta \phi_{t}=\left[\begin{array}{ccc}
\Delta \phi_{t}^{t+1,1} & \dots & \Delta \phi_{t}^{T,1}\\
\vdots &  & \vdots\\
\Delta \phi_{t}^{t+1,\kappa,} & \dots & \Delta \phi_{t}^{T,\kappa}
\end{array}\right]
\]
of the call options purchased/sold; here, $\Delta \phi_t^{\tau,i}$ denotes the number of call options with maturity $\tau$ and strike price $K_i$.

At $t=0$, the income of the company is
$$
y_0=-P_0\Delta s_0- \sum_{\tau=1}^{T}\sum_{i=1}^{\kappa}B_0^{\tau,i}\Delta \phi_0^{\tau,i},
$$
while, at any $0<t\leq T$, the income is
$$
y_t  =X_t-P_t \Delta s_t-\sum_{i=1}^{\kappa}\min(P_t,K_{i})\phi_{t-1}^{t,i}
-\sum_{\tau=0}^{t-1}Q_{\tau}^{t}\Delta f_{\tau}^t-\sum_{\tau=t+1}^{T}\sum_{i=1}^{\kappa}B_t^{\tau,i}\Delta\phi_t^{\tau-t,i}.
$$
Here, $f_t=\sum_{\tau=0}^t \Delta f^t_\tau$ and 
$\phi_t=\sum_{\tau=0}^t \Delta \phi_\tau^t$. Further, $X_t\in \R_+$ is the profit from the production at time $t$, $Y_t \in \R_+$ is the amount of the emissions at $t$, $P_t\in\R_{+}$ is the spot price at time $t$, $Q_t^\tau \in \R_+$ is the price of the future with maturity $\tau$ at time $t$, and $B_t^{\tau,i}\in \R_+$ is the premium paid at $t$ for the call option with strike price $K_i$ and maturity $\tau$. 

The aim of the company is to minimize $\rho(-y_0,\dots,-y_T)$
where $\rho$ is the nested mean-CVaR criterion; in particular, for any real $c_0,\dots,c_T$,
$$
\rho(c_0,\dots,c_T)=\mu_1(\mu_2(\dots\mu_T(c_0+\varrho c_1+\dots+\varrho ^ T c_T)\dots));
$$
where $\mu_t(Z)=(1-\lambda)\E(Z|\F_{t-1})+\lambda \mathrm{CVaR}_\alpha(Z|\F_{t-1})$, $0\leq \lambda \leq 1$ and $0<\alpha<1$ are constants and $\varrho$ is a discount factor.

Next we reformulate the decision problem into a form, which is more convenient for computation. 

Denote $e_t$ the amount of the allowances held (immediately after) $t$. Clearly, $e_0=\Delta s_0$ and 
\begin{equation}\label{eq:e}
e_t = e_{t-1}+\Delta s_t+r_t +
f_{t-1}^t+\sum_{i=1}^{\kappa}\phi_{t-1}^{t,i}-Y_t,
\end{equation}
As $\Delta f^t_\tau=f^t_\tau-f^t_{\tau-1}$, and similarly $\phi$, and as $\Delta s$ may be expressed from (\ref{eq:e}), we can alternatively take $e,f,\phi$ as decision variables. Further, as, at any $t$, the payment for futures with maturity $t$ is equal to $\sum_{\tau=0}^{t-1} b_\tau$ where $b_\tau \in  \F_\tau$, we may assume, without a change of the decision criterion's value, that $\varrho^{t-\tau}c_\tau$ is paid at each $0\leq \tau < T$ instead of the whole amount at $t$.

Consequently, the problem may be reformulated as
\[
\min_{x_{t}\in\X_{t},x_t \in \F_t 0\leq t\leq T}\rho\left(-z_{0},\dots,-z_{T}\right)
\]
where $\F_t$ is the filtration induced by process
$\xi_{t}=(X_{t},Y_{t},P_{t},Q_{t},B_t)$, where
$$
\X_{t}=\{(e_{t}, f_{t},\phi_{t}): e_0 \geq 0, f_0\geq0,
\phi_{0} \geq0.\},\qquad 0\leq t < T,$$
$$
\X_T = \{e_T:e_T=0\},
$$
and
$$
z_0=-P_0e_0-\sum_{\tau=1}^{T}\varrho^{\tau}Q_0^{\tau} f_0^{\tau}-  \sum_{\tau=1}^{T}\sum_{i=1}^{\kappa}B_0^{\tau,i}\phi_0^{\tau,i}, 
$$
\begin{multline*}
z_t  =X_t-P_t 
\left(
e_t -e_{t-1}-r_t-
f_{t-1}^t-\sum_{i=1}^{\kappa}\phi_{t-1}^{t,i}+Y_t
\right)
\\
-\sum_{i=1}^{\kappa}\min(P_t,K_{i})\phi_{t-1}^{t,i}
-\sum_{\tau=t+1}^{T}\varrho^{\tau-t}Q_t^{\tau}(f_t^{\tau}
-f_{t-1}^{\tau})
\\-\sum_{\tau=t+1}^{T}\sum_{i=1}^{\kappa}B_t^{\tau,i}
(\phi_t^{\tau,i}-\phi_{t-1}^{\tau,i}),\qquad 0<t\leq T.
\end{multline*}



\section{Data}

$T=0$ odpovídá začátku 2018, $T=3$ (end of 2020)

For the spot prices $P$ and the spreads $Q$ we adopt model from (anor). In particular, we fit the evolution of $P$ by 
\[
P_{t}=P_{0}\exp\left\{ \sum\nolimits_{\tau=1}^t u_{\tau} \right\},
\qquad u_t \sim \mathcal{N}\left(
-\frac{\sigma^2}{2},\sigma^2
\right),\qquad 1\leq t \leq T, 
\]
with $\sigma=0.439$ where $u_{1},\dots,u_T$ are i.i.d., and
\[
Q^\tau_{t}=P_t\exp\{(\tau-t)(0.00974+v^\tau_{t})\},\qquad v^\tau_{t}\sim \mathcal{N}(0,\varsigma^2),\qquad 1\leq t< \tau,\quad 1\leq \tau \leq T,
	\]
with $\varsigma=0.010$ where $v^2_1,v_1^3,v_2^3,\dots$ are i.i.d., independent of $u_1,\dots,u_T$.

The initial prices are equal to 
$$P_0=7.77, \quad Q^1_0=7.81,\quad Q^2_0=7.87,\quad Q^3_0=7.97$$ %markets.businessinsider.com

Option prices $B^{\tau,i}_t$ are computed by the Black-Scholes formula with the implied volatility being a quadratic function of the strike price relative to the spot price. The shape of the function, depicted in Picture XX, has been estimated using 110 observations of actual option prices on ???market. As the risk-less rate ??? was taken. 

\pgfimage[width=7cm]{smile}

Our model of profits $X$ and emissions $Y$ was estimated using their monthly hypothetical historical values from 2014 to 2016, which were constructed as follows: TBD FRANTA.

As all the correlations of any of $X_t,Y_t$ with any of $P_t$, $P_{t-1}$  and correlations of any of $\Delta X_t,\Delta Y_t$ with any of $\Delta P_t$, $\Delta P_{t-1}$ are insignificant, we model $X,Y$ alone, independently of $P$. The time series plots and xy--plots of processes $X_t,Y_t$ and the processes of their first differences can be seen in Figures:

\pgfimage[width=5cm]{tsplot}
\pgfimage[width=5cm]{dtsplot}


\pgfimage[width=5cm]{xyplot}
\pgfimage[width=5cm]{dxyplot}

In can be clearly seen that the values of $X_t$ and $Y_t$ ``go along'' as well as their first differences, so it is worth to model their evolution jointly. As the ADF tests rejected unit root hypothesis for both the series, we chose VAR model with the single lag to fit their time evolution:
\begin{equation}\label{xymodel}
\begin{aligned}
X_t&=2306	.45 +   1.26237 X_{t-1}  -0.158943 Y_{t-1} + \epsilon_t \\
Y_t&=12852.2  +   2.24683  X_{t-1} + \varepsilon_t
\end{aligned}
\end{equation}
with $\mathrm{stdev}(\epsilon_1)=809.6647$, $\mathrm{stdev}(\varepsilon_1)=4882.004$ and $\mathrm{corr}(\epsilon_1,\varepsilon_1)=0.907$. Highly improbable negative observations are truncated to zero, if they appear during the computation. 

The initial values 
$$
X_0 = 2744.83,\qquad Y_0 = 18982.64
$$
were obtained by a year-ahead forecast in (\ref{xymodel}).

\end{document}

Oba modely znovu odhadnu, ale asi by to chtělo z čerstvějších dat, takže bych poprosil spoty a futury až do konce 2017, nemusejí být moc do minulosti, stačí rok dva (denních dat)

Nově máme
\begin{itemize}
\item $B$ - opce. Tady bych poprosil o odhad tebe (nikdy jsem to nedělal, tak to vyjde nastejno:-)). Rámocový postup: vzít historické ceny opcí, vyjádřit si jejich cenu pomocí black scholese s neznámou volatilitou a pak tu volatilitu nastavit tak, aby seděla (výsledku se říká implikovaná volatilita). Jako bezrizikový výnos lze vzít některou úrokovou sazbu ČNB. Pokud bude implikovaná volatilita pro jednotlivé strike ceny hodně jiná, bude se muset udělat něco jako "adjust for smile effect". Výsledkem bude vzoreček, do kterého pak já dosadím spot cenu a strike cenu, a on mmi vyhodí cenu opce. V nesnázích by asi bylo možné obrátit se na Tomáše Tichého (kdyžtak zprostředkuju)
\item $X_t$, $Y_t$:  tohle je na vás. Protože se ani $X_t$ ani $Y_t$ nenásobí s jinou rozhodovací proměnnou, může se udělat trik, že se $X$ a $Y$ budou považovat za rozhodovací proměnnou a tím se může zachovat stagewise independence. 

Můžeme mít například
$$
(X_t,Y_t)' = A (X_{t-1},Y_{t-1})' + b P_{t-1} +  c P_t + \epsilon_t, 
$$
kde $A \in \R^{2 \times 2}$, $b,c \in \R^{1\times 2}$ a $\epsilon_t$ jsou i.i.d.
(tam by bylo $\zeta_t = (X_t,Y_t)', \zeta_t = r_{t-1}+c P_t + \epsilon_t$, $r_{t-1}= A \zeta_{t-1} + b P_{t-1}$), 

Nebo třeba
$$
(X_t,Y_t)'= A(X_{t-1},Y_{t-1})' P^\alpha_{t-1} P^\beta_t  \epsilon_t
$$
$\alpha,\beta \geq 0$ (tam by bylo $\zeta_t = r_{t-1} P^\beta_t\epsilon_t, r_{t-1}=w_{t-1} P^\alpha_{t-1}, w_{t-1} = A \zeta_{t-1}$)
První způsob je jednodušší, ale může nás dostat do mínusu, druhej je krkolomnější.

Pokud se ale vzdáme interakcí mezi $X$ a $Y$, a budeme předpokládat 
$$
X_t=a X_{t-1} p_{t-1}^\beta p_t^\gamma\epsilon_t
$$
(podobně $Y$), pak je to celkem elegantní, protože se to dá přepsat jako $x_t=\log a + x_{t-1} + \alpha P_{t-1} + \beta P_t +\varepsilon_t$  kde $x_t=\log X_t$. (Samozřejmě by bylo skvělý mít koeficient i u $x_{t-1}$, ale to bhžl nejde).

Ve všech případech může být reziduum korelované (takže přírůstky $X$ mohou přirozeně souviset s přírůstky $Y$).

\end{itemize}

\end{document}
